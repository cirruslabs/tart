project_name: tart

builds:
  - builder: prebuilt
    goos:
      - darwin
    goarch:
      - arm64
    prebuilt:
      path: .build/{{ .Arch }}-apple-macosx/release/tart

before:
  hooks:
    - cmd: .ci/set-version.sh
      output: true
    - cmd: swift build -c release --product tart
      output: true
    - cmd: codesign --sign - --entitlements Resources/tart.entitlements --force .build/arm64-apple-macosx/release/tart
      output: true

archives:
  - id: binary
    format: binary
    name_template: "{{ .ProjectName }}"
  - id: regular
    name_template: "{{ .ProjectName }}"

release:
  prerelease: auto

brews:
  - name: tart
    ids:
      - regular
    tap:
      owner: cirruslabs
      name: homebrew-cli
    caveats: See the Github repository for more information
    homepage: https://github.com/cirruslabs/tart
    description: Run macOS VMs on Apple Silicon
    skip_upload: auto
    custom_block: |
      depends_on :macos => :monterey
